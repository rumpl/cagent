agents:
  root:
    model: anthropic/claude-sonnet-4-5
    instruction: |
      You are a code reviewer. Review the PR diff from the provided GitHub PR URL and post inline comments.
      The user's message contains a GitHub Pull Request URL (e.g., https://github.com/owner/repo/pull/123).

      Steps:
      1. Use the shell to call "gh" to get all of the information about the Pr
      2. Review the PR diff, focusing on lines that were ADDED (+) or MODIFIED.
      3. Make sure to get the overall picture about the changes, read the files from the current directory as needed
      4. Review the code changes in detail
      5. Use gh to add inline comments for specific lines of code that need attention
      6. Post your review

      ## Review Focus
      **Code Quality:** Readability, naming, structure, DRY
      **Correctness:** Logic errors, edge cases, error handling, type safety
      **Security:** Input validation, SQL/XSS vulnerabilities, hardcoded secrets
      **Performance:** Inefficient algorithms, unnecessary operations, memory leaks
      **Best Practices:** Framework conventions, testing, documentation, accessibility

      # Go Specialization to Add

      ## Focus Areas (for `+` lines only)
      - **Correctness:** Control flow, edge cases, nil checks
      - **Idiomatic Go:** Conventions, stdlib patterns
      - **Error Handling:** Proper wrapping (fmt.Errorf %w), sentinel errors, avoid panic
      - **Concurrency:** Race conditions, mutex usage, channels, context cancellation
      - **Performance:** Unnecessary allocations, strings.Builder, efficient algorithms
      - **Context:** As first parameter, respect cancellation, don't store in structs
      - **Resource Management:** Proper defer (Close, Unlock), no leaks
      - **Interfaces:** Accept interfaces, return structs, small focused interfaces
      - **Testing:** testify, table-driven tests, proper naming
      - **Security:** SQL/command injection, input validation, hardcoded secrets
      - `interface{}`/`any` without type assertions
      - Not checking error returns
      - Goroutine leaks
      - Mutex copied by value
      - Range variable capture in goroutines
      - Comparing errors with == (use errors.Is/As)

      **Be constructive, concise, specific, respectful.**
    toolsets:
      - type: filesystem
        tools: [read_file, read_multiple_files, list_directory, directory_tree]
      - type: script
        shell:
          gh:
            cmd: gh $arguments
            description: GitHub CLI
            required: ["arguments"]
            args:
              "arguments":
                description: Arguments to pass to the gh command
                type: array
          add_inline_comment:
            cmd: |
              gh api repos/$repo/pulls/$pr_number/comments \
              -f body="$body" \
              -f commit_id=$(gh pr view $pr_number --repo $repo --json headRefOid -q .headRefOid) \
              -f path="$path" \
              -F line=$line
            description: Add an inline comment to a GitHub PR
            required: ["repo", "pr_number", "body", "path", "line"]
            args:
              repo:
                description: GitHub repository in the format "owner/repo"
                type: string
              pr_number:
                description: Pull request number
                type: integer
              body:
                description: Comment body
                type: string
              path:
                description: File path in the repository
                type: string
              line:
                description: Line number in the file to comment on
                type: integer
          add_comment: 
            cmd: |
              gh pr review $pr_number --repo $repo --body "$body"
            description: Add a general review comment to a GitHub PR
            required: ["repo", "pr_number", "body"]
            args:
              repo:
                description: GitHub repository in the format "owner/repo"
                type: string
              pr_number:
                description: Pull request number
                type: integer
              body:
                description: Comment body
                type: string
